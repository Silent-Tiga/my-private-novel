---
title: "权限测试"
date: 2024-01-01
description: "测试前端权限控制功能"
draft: false
---

## 权限测试页面

本页面用于测试网站的权限控制功能，包括：

1. **用户登录状态**：显示当前登录用户的信息和权限
2. **上传功能**：测试前端上传器是否正常显示和工作
3. **评论功能**：测试评论系统是否需要登录才能使用

### 如何测试

1. 使用不同角色的账号登录（admin/editor/reader）
2. 检查登录后是否显示相应的功能按钮
3. 尝试使用上传功能和评论功能

### 测试用户信息

<div id="user-info-display" style="background-color: var(--card-bg-color); padding: 20px; border-radius: 8px; margin: 20px 0;">
    <p>正在检查用户登录状态...</p>
</div>

### 测试上传功能

<div style="margin: 20px 0;">
    <p>如果您有写权限，右下角应该会显示一个带加号的浮动按钮。</p>
    <p>点击按钮可以打开上传器，尝试上传不同类型的内容。</p>
</div>

### 测试评论功能

<div style="margin: 20px 0;">
    <p>请尝试发表评论，系统应该会自动填充您的用户名（如果已登录）。</p>
</div>

<!-- 包含评论系统 -->
{{ partial "comments.html" . }}

<script>
    // 显示用户信息
    function displayUserInfo() {
        const userInfoDisplay = document.getElementById('user-info-display');
        const user = getCurrentUser();
        
        if (user) {
            userInfoDisplay.innerHTML = `
                <h4>当前登录用户信息</h4>
                <p><strong>用户名：</strong>${user.sub}</p>
                <p><strong>角色：</strong>${user.role}</p>
                <p><strong>权限：</strong>${user.permissions.join(', ')}</p>
                <p><strong>令牌过期时间：</strong>${new Date(user.exp).toLocaleString()}</p>
                <button id="test-logout-btn" style="margin-top: 10px; padding: 8px 16px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    登出测试
                </button>
            `;
            
            // 添加登出按钮事件
            document.getElementById('test-logout-btn').addEventListener('click', function() {
                clearAccess();
                location.reload();
            });
        } else {
            userInfoDisplay.innerHTML = `
                <p>您尚未登录，请使用以下链接登录：</p>
                <a href="javascript:showLoginForm();" style="color: var(--primary-color); text-decoration: underline;">点击此处登录</a>
            `;
        }
    }
    
    // 页面加载完成后显示用户信息
    document.addEventListener('DOMContentLoaded', function() {
        displayUserInfo();
        
        // 如果评论系统已经初始化，检查评论表单是否已禁用
        if (typeof commentAuthor !== 'undefined') {
            const user = getCurrentUser();
            if (user && user.name) {
                commentAuthor.value = user.name;
                commentAuthor.disabled = true;
            }
        }
    });
</script>