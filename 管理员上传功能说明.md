# 管理员上传功能说明

## 功能概述

此功能允许管理员通过网页界面直接上传小说章节和图片到GitHub仓库，而不需要使用数据库存储内容。主要特点：

- 通过网页端Markdown编辑器直接创建和编辑章节内容
- 支持图片上传（会自动保存到GitHub仓库的static/images目录）
- 不依赖数据库，内容直接提交到GitHub仓库
- 自动生成必要的Front Matter元数据

## 配置和使用步骤

### 步骤1：准备GitHub仓库

1. 在GitHub上创建一个**私有仓库**（推荐名称：`my-private-novel`）
2. 将您的Hugo网站代码推送到这个仓库

### 步骤2：获取GitHub Personal Access Token

1. 登录GitHub，点击右上角头像 → **Settings**
2. 进入 **Developer settings** → **Personal access tokens** → **Tokens (classic)**
3. 点击 **Generate new token** → **Generate new token (classic)**
4. 输入描述名称，选择适当的过期时间
5. 在**Select scopes**中，勾选 `repo` 权限（允许读写仓库）
6. 点击 **Generate token** 按钮
7. **重要**：复制生成的Token并保存到安全的地方，离开页面后将无法再次查看

### 步骤3：使用管理员上传页面

1. 访问您的网站，点击顶部导航栏中的**管理员上传**链接
2. 填写表单信息：
   - **GitHub Personal Access Token**：输入您在步骤2中获取的Token
   - **GitHub 仓库**：格式为 `用户名/仓库名`，例如 `yourusername/my-private-novel`
   - **小说集**：从下拉列表中选择要添加章节的小说集
   - **分卷**：输入分卷名称，例如 `volume1`
   - **章节标题**：输入新章节的标题
   - **章节内容**：输入章节内容，支持Markdown格式
   - **上传图片**：点击或拖拽上传图片
3. 点击**提交到GitHub**按钮
4. 等待上传完成，成功后会显示成功提示

## Markdown语法参考

在章节内容中，您可以使用以下Markdown语法：

- **标题**：`# 一级标题` `## 二级标题` `### 三级标题`
- **加粗**：`**粗体文本**`
- **斜体**：`*斜体文本*`
- **链接**：`[链接文本](链接地址)`
- **图片**：`![图片描述](图片URL)`
- **列表**：
  - 无序列表：`- 项目1` `* 项目2`
  - 有序列表：`1. 项目1` `2. 项目2`
- **引用**：`> 引用文本`
- **代码**：`` `单行代码` `` 或 ``` 多行代码 ```

## 工作原理

此功能的工作原理如下：

1. 用户在网页表单中填写内容和GitHub认证信息
2. 点击提交后，JavaScript代码将：
   - 读取表单数据和图片文件
   - 将文件内容转换为Base64编码
   - 使用GitHub REST API（通过用户提供的Token）将文件直接提交到GitHub仓库
3. 提交成功后，Netlify或其他CI/CD服务可以自动检测仓库变更并重新构建网站

## 安全注意事项

1. **保护您的GitHub Token**：不要与他人分享您的Token，它可以访问您的GitHub仓库
2. **使用私有仓库**：确保您的仓库设置为私有，防止他人访问您的内容
3. **定期更新Token**：建议定期更新您的GitHub Token以提高安全性
4. **权限最小化**：只授予Token必要的最小权限（仅`repo`权限）

## 故障排除

如果您在使用过程中遇到问题，可以尝试以下解决方案：

1. **上传失败**：检查GitHub Token是否正确，确保它具有仓库的读写权限
2. **图片不显示**：确保图片上传成功，然后查看网站是否已重新构建
3. **内容未更新**：如果使用了CI/CD服务，请检查构建日志是否有错误
4. **API请求限制**：GitHub API有请求频率限制，如果遇到限制，请稍后再试

## 高级配置

如果您想进一步自定义此功能，可以修改以下文件：

- **模板文件**：`layouts/admin/single.html` - 包含表单和JavaScript代码
- **内容文件**：`content/admin/_index.md` - 包含页面的基本信息
- **导航配置**：`config.yaml` - 可以修改导航链接的名称和权重

## 其他说明

- 此功能设计为只允许管理员使用，不建议对普通用户开放
- 所有上传的内容都会成为仓库的一部分，建议定期备份您的仓库
- 如果您的网站使用了CI/CD服务（如Netlify），可以配置自动构建以更新网站内容