<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>站点动态 | 我的私人论坛</title>
<meta name=description content="我的私人小说空间"><script id=cloudbase-config type=application/json>{"envId":"\"my-private-forum-7fq5eue4c2a67da\"","collections":{"users":"\"users\"","posts":"\"posts\"","novels":"\"novels\"","site_settings":"\"site_settings\""}}</script><script>(function(){var e=["/lib/cloudbase.full.js","/lib/cloudbase.min.js","https://static.cloudbase.net/cloudbase-js-sdk/2.21.6/cloudbase.full.js?v=1","https://unpkg.com/@cloudbase/js-sdk/dist/cloudbase.min.js","https://cdn.jsdelivr.net/npm/@cloudbase/js-sdk/dist/cloudbase.min.js","https://imgcache.qq.com/qcloud/cloudbase-js-sdk/1.7.2/cloudbase.min.js"];function t(s){if(s>=e.length){console.error("[CloudBase] SDK 加载失败（所有源不可用）"),n(!1);return}var o=document.createElement("script");o.src=e[s],o.referrerPolicy="no-referrer",o.crossOrigin="anonymous",o.onload=function(){n(!0)},o.onerror=function(){console.warn("[CloudBase] SDK 源失败：",e[s]),t(s+1)},document.head.appendChild(o)}function n(e){try{if(!e||typeof cloudbase=="undefined")throw new Error("cloudbase is not defined");var t,n,o,i,r,c,l,d,a=document.getElementById("cloudbase-config"),s={};try{s=JSON.parse(a&&a.textContent||"{}")}catch{}n=s.envId||"";try{n=(n||"").replace(/"/g,"").trim()}catch{}o=cloudbase.init({env:n}),t=o.auth({persistence:"local"}),r=o.database(),window.cloudbaseApp=o,window.cloudbaseAuth=t,window.cloudbaseDb=r,window.cloudbaseCollections=s.collections||{},window.CLOUDBASE_ENV_ID=n,console.log("[CloudBase] 初始化成功",{envId:n,version:cloudbase.version}),console.log("[CloudBase] auth 实例：",t);try{c=location.hostname==="127.0.0.1"||location.hostname==="localhost",l=!!(t&&t.currentUser),d=!!(t&&(t.anonymousAuthProvider||t.signInAnonymously)),i=!c,!l&&d&&i?t.anonymousAuthProvider?t.anonymousAuthProvider().signIn().catch(function(e){console.warn("[CloudBase] 匿名登录失败",e)}):t.signInAnonymously&&t.signInAnonymously().catch(function(e){console.warn("[CloudBase] 匿名登录失败",e)}):i||console.log("[CloudBase] 开发环境：已禁用自动匿名登录")}catch{}}catch(e){console.error("[CloudBase] 初始化失败",e)}}t(0)})()</script><script>(function(){try{var n=location.hostname==="127.0.0.1"||location.hostname==="localhost",e="http://127.0.0.1:3000/auth",t="https://my-private-forum-7fq5eue4c2a67da.ap-shanghai.app.tcloudbase.com/auth";n?(window.cloudbaseAuthEndpoint=e,window.cloudbaseCustomTicketEndpoint=e):t&&(window.cloudbaseAuthEndpoint=t)}catch{}})()</script><script type=application/json id=access-control-config>{"enabled":true,"persistentAccess":true,"users":{"admin":{"password":"admin2024","role":"admin","permissions":["read","write","delete","admin"]},"editor":{"password":"editor2024","role":"editor","permissions":["read","write"]},"reader":{"password":"reader2024","role":"reader","permissions":["read"]}},"defaultAccessKey":"","defaultRole":"reader","jwtSecret":"","jwtExpiration":864e5,"whitelistPaths":["/login/","/about/"]}</script><script>(function(){try{const e=document.getElementById("access-control-config"),t=e?JSON.parse(e.textContent):{};window.accessControl=window.accessControl||t}catch(e){console.warn("Failed to parse access-control-config JSON",e),window.accessControl=window.accessControl||{}}})();const accessControl=window.accessControl;function getLocalUser(){try{const e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}catch{return null}}async function getCurrentUser(){try{const n=localStorage.getItem("currentUser");if(n)try{return JSON.parse(n)}catch{}const t=window.cloudbaseAuth;if(!t||typeof t.getCurrentUser!="function")return null;const e=await t.getCurrentUser();if(!e)return null;const s=e.uid==="admin"?"admin":"reader",i=s==="admin"?["read","write","delete","admin"]:["read"],o={uid:e.uid,email:e.email||"",role:s,permissions:i};try{localStorage.setItem("currentUser",JSON.stringify(o))}catch{}return o}catch(e){return console.warn("CloudBase 当前用户获取失败:",e),null}}function checkAccess(){const t=window.location.pathname,n=Array.isArray(accessControl.whitelistPaths)?accessControl.whitelistPaths:[];for(const e of n)if(t.startsWith(e))return!0;const e=getLocalUser();return!!(e&&e.uid)}function clearAccess(){try{const e=window.cloudbaseAuth;e&&typeof e.signOut=="function"&&e.signOut()}catch(e){console.warn("CloudBase signOut 失败:",e)}window.__CURRENT_USER__=null;try{localStorage.removeItem("novelAccessVerified"),localStorage.removeItem("hasAccess"),localStorage.removeItem("currentUser")}catch{}}function hasPermission(e){const t=getLocalUser();return!!t&&(t.role==="admin"||Array.isArray(t.permissions)&&t.permissions.includes(e))}async function ensureUserProfile(){try{const n=window.cloudbaseAuth,s=window.cloudbaseDb;if(!n||!s||typeof n.getCurrentUser!="function")return;const e=await n.getCurrentUser();if(!e)return;const o=window.cloudbaseCollections&&window.cloudbaseCollections.users||"users";let t=null;try{const n=await s.collection(o).doc(e.uid).get();if(n&&n.data&&n.data.length)t=n.data[0];else{const n="reader",i=["read"];await s.collection(o).doc(e.uid).set({uid:e.uid,email:e.email||"",role:n,permissions:i,createdAt:Date.now()}),t={uid:e.uid,email:e.email||"",role:n,permissions:i}}}catch(n){console.warn("读取/初始化用户档案失败，使用默认 reader：",n),t={uid:e.uid,email:e.email||"",role:"reader",permissions:["read"]}}try{localStorage.setItem("currentUser",JSON.stringify(t))}catch{}}catch(e){console.warn("ensureUserProfile 失败:",e)}}document.addEventListener("DOMContentLoaded",function(){ensureUserProfile()});function showUserInfo(){const a=getLocalUser();if(!a)return;const e=document.createElement("div");e.style.position="fixed",e.style.top="16px",e.style.right="16px",e.style.padding="10px 12px",e.style.backgroundColor="var(--card-bg-color, #f9f9f9)",e.style.borderRadius="4px",e.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",e.style.display="flex",e.style.alignItems="center",e.style.gap="8px";const i=document.createElement("span");i.textContent=`角色: ${a.role}`,i.style.color="var(--text-color, #333)",i.style.fontSize="0.875rem";const o=document.createElement("span");o.textContent="昵称: (加载中)",o.style.color="var(--text-color, #333)",o.style.fontSize="0.875rem";const t=document.createElement("button");t.textContent="改昵称",t.style.padding="4px 8px",t.style.backgroundColor="#3498db",t.style.color="white",t.style.border="none",t.style.borderRadius="4px",t.style.fontSize="0.75rem",t.style.cursor="pointer",t.addEventListener("click",async function(){const e=prompt("输入新的昵称（不超过64字符）");if(!e)return;try{const t=window.cloudbaseAuth,n=window.cloudbaseDb;if(!t||!n||typeof t.getCurrentUser!="function"){alert("未登录，无法修改昵称");return}const s=await t.getCurrentUser(),i=window.cloudbaseCollections&&window.cloudbaseCollections.users||"users";await n.collection(i).doc(s.uid).update({nickname:e,updatedAt:Date.now()});try{const t=getLocalUser();t&&(t.nickname=e,localStorage.setItem("currentUser",JSON.stringify(t)))}catch{}o.textContent=`昵称: ${e}`}catch(e){alert(e.message||"更新失败")}});const n=document.createElement("button");n.textContent="改密码",n.style.padding="4px 8px",n.style.backgroundColor="#f39c12",n.style.color="white",n.style.border="none",n.style.borderRadius="4px",n.style.fontSize="0.75rem",n.style.cursor="pointer",n.addEventListener("click",async function(){try{const s=prompt("输入原密码");if(!s)return;const o=prompt("输入新密码");if(!o)return;const n=getLocalUser();if(!n||!n.uid){alert("未登录，不能改密");return}const i=window.CLOUDBASE_ENV_ID;let t=window.cloudbaseAuthEndpoint||window.cloudbaseCustomTicketEndpoint;if(!t&&i&&(t=`https://${i}.ap-shanghai.app.tcloudbase.com/auth`),!t){alert("登录接口未配置，请设置 window.cloudbaseAuthEndpoint 或 cloudbaseCustomTicketEndpoint");return}const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"changePassword",data:{username:n.uid,oldPassword:s,newPassword:o}})}),e=await a.json();if(e&&e.success){alert("密码修改成功，请重新登录");try{await window.cloudbaseAuth.signOut()}catch{}localStorage.removeItem("currentUser"),location.reload()}else alert("修改失败："+(e&&e.error?e.error:"未知错误"))}catch(e){alert("修改失败："+(e.message||"网络错误"))}});const s=document.createElement("button");s.textContent="登出",s.style.padding="4px 8px",s.style.backgroundColor="#e74c3c",s.style.color="white",s.style.border="none",s.style.borderRadius="4px",s.style.fontSize="0.75rem",s.style.cursor="pointer",s.addEventListener("click",function(){clearAccess(),location.reload()}),e.appendChild(i),e.appendChild(o),e.appendChild(t),e.appendChild(n),e.appendChild(s),document.body.appendChild(e),function(){const e=getLocalUser();if(!e){o.textContent="昵称: (未登录)";return}o.textContent=`昵称: ${e.nickname||"(未设置)"}`}()}function createLoginForm(){document.body.innerHTML="",document.body.style.backgroundColor="#f5f5f5",document.body.style.display="flex",document.body.style.flexDirection="column",document.body.style.justifyContent="center",document.body.style.alignItems="center",document.body.style.minHeight="100vh",document.body.style.margin="0",document.body.style.padding="0",document.body.style.boxSizing="border-box";const s=document.createElement("div");s.style.width="100%",s.style.maxWidth="400px",s.style.padding="2rem",s.style.backgroundColor="white",s.style.borderRadius="8px",s.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)",s.style.textAlign="center";const d=document.createElement("h1");d.textContent="私人小说库",d.style.color="#3a7bd5",d.style.marginBottom="1.5rem",d.style.fontSize="1.8rem";const m=document.createElement("p");m.textContent="请登录以继续",m.style.color="#666",m.style.marginBottom="2rem";const i=document.createElement("form");i.addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("username").value.trim(),n=document.getElementById("password").value.trim();try{if(!t||!n)throw new Error("请输入用户名与密码");const e=window.cloudbaseAuth;let s=!1,o=null;try{if(e&&typeof e.signInWithCustomTicket=="function"){const r=window.CLOUDBASE_ENV_ID;let a=window.cloudbaseAuthEndpoint||window.cloudbaseCustomTicketEndpoint;if(!a&&r&&(a=`https://${r}.ap-shanghai.app.tcloudbase.com/auth`),!a)throw new Error("登录接口未配置，请设置 window.cloudbaseAuthEndpoint 或 cloudbaseCustomTicketEndpoint");const c=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"login",data:{username:t,password:n}})}),i=await c.json();if(i&&i.success&&i.token)await e.signInWithCustomTicket(i.token),s=!0,o=i.user||{uid:t};else throw new Error(i&&i.error?i.error:"登录失败")}}catch(e){console.warn("自定义登录失败",e)}if(!s)throw new Error("用户名或密码错误");localStorage.setItem("currentUser",JSON.stringify(o)),location.reload();return}catch(e){console.error("登录失败",e),document.getElementById("errorMessage").textContent=e&&e.message?e.message:"登录失败，请检查账户或网络",setTimeout(function(){document.getElementById("errorMessage").textContent=""},3e3)}});const u=document.createElement("div");u.style.marginBottom="1.5rem";const a=document.createElement("label");a.textContent="用户名（必填）",a.htmlFor="username",a.style.display="block",a.style.textAlign="left",a.style.color="#333",a.style.marginBottom="0.5rem";const n=document.createElement("input");n.type="text",n.id="username",n.placeholder="请输入用户名",n.style.width="100%",n.style.padding="0.75rem",n.style.border="1px solid #ddd",n.style.borderRadius="4px",n.style.backgroundColor="white",n.style.color="#333",n.style.fontSize="1rem",n.addEventListener("focus",function(){n.style.borderColor="#3a7bd5"}),n.addEventListener("blur",function(){n.style.borderColor="#ddd"}),u.appendChild(a),u.appendChild(n);const h=document.createElement("div");h.style.marginBottom="1.5rem";const r=document.createElement("label");r.textContent="密码（必填）",r.htmlFor="password",r.style.display="block",r.style.textAlign="left",r.style.color="#333",r.style.marginBottom="0.5rem";const e=document.createElement("input");e.type="password",e.id="password",e.placeholder="请输入密码",e.style.width="100%",e.style.padding="0.75rem",e.style.border="1px solid #ddd",e.style.borderRadius="4px",e.style.backgroundColor="white",e.style.color="#333",e.style.fontSize="1rem",e.setAttribute("autocomplete","off"),e.addEventListener("focus",function(){e.style.borderColor="#3a7bd5"}),e.addEventListener("blur",function(){e.style.borderColor="#ddd"}),h.appendChild(r),h.appendChild(e);const l=document.createElement("div");l.id="errorMessage",l.style.color="#e74c3c",l.style.fontSize="0.875rem",l.style.marginTop="0.5rem";const t=document.createElement("button");t.type="submit",t.textContent="登录",t.style.width="100%",t.style.padding="0.75rem",t.style.backgroundColor="#3a7bd5",t.style.color="white",t.style.border="none",t.style.borderRadius="4px",t.style.fontSize="1rem",t.style.cursor="pointer",t.style.transition="background-color 0.3s",t.addEventListener("mouseenter",function(){t.style.backgroundColor="#00d2ff"}),t.addEventListener("mouseleave",function(){t.style.backgroundColor="#3a7bd5"});const c=document.createElement("div");c.style.display="flex",c.style.justifyContent="center",c.style.gap="12px",c.style.marginBottom="1rem";const o=document.createElement("button");o.type="button",o.textContent="登录",o.style.padding="6px 12px",o.style.border="1px solid #3a7bd5",o.style.backgroundColor="#3a7bd5",o.style.color="white",o.style.borderRadius="4px",c.appendChild(o),o.addEventListener("click",function(){i.style.display="block",o.style.backgroundColor="#3a7bd5",o.style.color="white"}),i.style.display="block",i.appendChild(u),i.appendChild(h),i.appendChild(l),i.appendChild(t),s.appendChild(d),s.appendChild(m),s.appendChild(c),s.appendChild(i),document.body.appendChild(s),window.showLoginForm=createLoginForm}function initAccessControl(){if(accessControl.enabled){const e=checkAccess();e?(showUserInfo(),applyPermissionControls()):createLoginForm()}}function applyPermissionControls(){document.querySelectorAll("[data-permission]").forEach(e=>{const t=e.getAttribute("data-permission");hasPermission(t)||(e.style.display="none")})}window.addEventListener("DOMContentLoaded",initAccessControl),window.auth={hasPermission,getCurrentUser,clearAccess}</script><style>:root{--primary-color:#3a7bd5;--secondary-color:#00d2ff;--text-color:#333;--light-text:#666;--background-color:#fff;--card-bg:#f9f9f9;--border-color:#eee;--hover-bg:#f0f8ff}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,Oxygen,Ubuntu,Cantarell,open sans,helvetica neue,sans-serif;line-height:1.6;color:var(--text-color);background-color:var(--background-color);max-width:900px;margin:0 auto;padding:20px}header{border-bottom:1px solid var(--border-color);padding-bottom:20px;margin-bottom:30px}header h1{color:var(--primary-color);margin-bottom:10px}header p{color:var(--light-text)}nav{margin-bottom:30px}nav ul{list-style:none;display:flex;gap:25px;flex-wrap:wrap}nav a{text-decoration:none;color:var(--primary-color);font-weight:500;padding:8px 0;border-bottom:2px solid transparent;transition:all .3s ease}nav a:hover{border-bottom-color:var(--primary-color)}main{min-height:500px}h1,h2,h3{margin-bottom:20px;line-height:1.3}h1{font-size:2.2rem}h2{font-size:1.8rem;margin-top:40px;color:var(--primary-color)}h3{font-size:1.4rem;margin-top:30px}p{margin-bottom:20px}a{color:var(--primary-color);text-decoration:none;transition:color .3s ease}a:hover{color:var(--secondary-color)}.novel-collections{margin-top:30px}.collection-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px}.collection-item{background-color:var(--card-bg);padding:20px;border-radius:8px;transition:transform .3s ease,box-shadow .3s ease}.collection-item:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,0,0,.1)}.collection-item h2{margin-top:0;font-size:1.5rem}.volume-list{margin-top:20px}.volume-item{background-color:var(--card-bg);padding:20px;border-radius:8px;margin-bottom:20px;transition:background-color .3s ease}.volume-item:hover{background-color:var(--hover-bg)}.chapter-list{margin-top:20px}.chapter-item{padding:15px 0;border-bottom:1px solid var(--border-color);transition:padding-left .3s ease}.chapter-item:hover{padding-left:10px}.chapter-item:last-child{border-bottom:none}.chapter-item .date{color:var(--light-text);font-size:.9rem;margin-top:5px}.article{margin-top:30px}.article-meta{display:flex;gap:20px;color:var(--light-text);margin-bottom:20px;font-size:.9rem}.article-content{margin-top:30px}.article-content h2{margin-top:40px;margin-bottom:20px}.article-content h3{margin-top:30px;margin-bottom:15px}.article-content p{margin-bottom:20px;text-align:justify}.post-nav{display:flex;justify-content:space-between;margin-top:40px;padding-top:20px;border-top:1px solid var(--border-color)}.next-volume,.prev-volume,.next-chapter,.prev-chapter{padding:10px 15px;background-color:var(--card-bg);border-radius:5px;display:inline-block;margin:10px 0}.back-to-collection,.back-to-volume{margin-top:20px;text-align:center}.back-to-collection a,.back-to-volume a{display:inline-block;padding:10px 20px;background-color:var(--primary-color);color:#fff;border-radius:5px;transition:background-color .3s ease}.back-to-collection a:hover,.back-to-volume a:hover{background-color:var(--secondary-color);color:#fff}.latest-updates{margin-top:20px}.update-item{padding:15px 0;border-bottom:1px solid var(--border-color)}.update-item:last-child{border-bottom:none}.update-item .meta{color:var(--light-text);font-size:.9rem;margin-top:5px}footer{margin-top:60px;padding-top:30px;border-top:1px solid var(--border-color);text-align:center;color:var(--light-text);font-size:.9rem}@media(max-width:768px){h1{font-size:1.8rem}h2{font-size:1.5rem}h3{font-size:1.2rem}.collection-list{grid-template-columns:1fr}.post-nav{flex-direction:column;gap:10px}.article-meta{flex-direction:column;gap:5px}}</style></head><body><header><h1><a href=https://silent-tiga.github.io/my-private-novel/>我的私人论坛</a></h1><p>我的私人小说空间</p></header><style>.nav-bar{display:flex;gap:18px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border-color)}.nav-item{position:relative}.nav-link{text-decoration:none;color:var(--text-color);font-weight:600;padding:6px 8px;border-radius:6px}.nav-link:hover{background:#eef2ff;color:#1d4ed8}.dropdown{position:relative}.dropdown .nav-link::after{content:" ▾";font-weight:400}.dropdown-menu{position:absolute;top:100%;left:0;min-width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,8%);padding:8px;display:none;z-index:100}.dropdown:hover .dropdown-menu{display:block}.dropdown-item{display:flex;justify-content:space-between;align-items:center;text-decoration:none;color:#334155;padding:8px 10px;border-radius:6px}.dropdown-item:hover{background:#f1f5f9}</style><nav class=nav-bar><div class="nav-item dropdown"><a class=nav-link href>探索</a><div class=dropdown-menu><a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/>首页<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/all/>全部页面<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/tags/>标签<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/posts/>最近博文<span>›</span></a></div></div><div class="nav-item dropdown"><a class=nav-link href>信息</a><div class=dropdown-menu><a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/characters/>角色百科<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/works/>作品列表<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/info/tiers/>等级体系<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/info/glossary/>术语表<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/info/important/>重要页面<span>›</span></a></div></div><div class="nav-item dropdown"><a class=nav-link href>精选</a><div class=dropdown-menu><a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/featured/characters/>精选角色<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/featured/works/>热门作品<span>›</span></a></div></div><div class="nav-item dropdown"><a class=nav-link href>指南</a><div class=dropdown-menu><a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/guides/editing/>编辑指南<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/guides/format/>格式规范<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/guides/terminology/>术语规范<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/guides/calculation/>计算说明<span>›</span></a></div></div><div class="nav-item dropdown"><a class=nav-link href>社区</a><div class=dropdown-menu><a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/forum/discussion/>讨论归档<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/community/rules/>站点规则<span>›</span></a>
<a class=dropdown-item href=https://silent-tiga.github.io/my-private-novel/community/management/>站点管理<span>›</span></a></div></div><div class=nav-item><a class=nav-link href=https://silent-tiga.github.io/my-private-novel/about/>关于本站</a></div><div class=nav-item><a class=nav-link href=https://silent-tiga.github.io/my-private-novel/novels/>小说</a></div></nav><main><div class=volume><h1>站点动态</h1><div class=volume-content></div><h2>章节列表</h2><div class=chapter-list><div class=chapter-item><a href=https://silent-tiga.github.io/my-private-novel/posts/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E6%96%87/><h3>第一篇博文</h3><p class=date>2025-10-26</p></a></div></div><div class=volume-navigation></div><div class=back-to-collection><a href=https://silent-tiga.github.io/my-private-novel/tags/>返回 Tags</a></div></div></main><footer><p>&copy; 2025 我的私人论坛. 保留所有权利。</p></footer><div id=uploader-float-btn style=display:none;position:fixed;bottom:30px;right:30px;z-index:1000><button id=show-uploader-btn style="width:60px;height:60px;border-radius:50%;background-color:var(--primary-color);color:#fff;border:none;font-size:24px;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,.2);transition:all .3s ease">
+</button></div><div id=uploader-modal style=display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:1001;justify-content:center;align-items:center><div id=uploader-container style=background-color:#fff;border-radius:8px;padding:20px;width:100%;max-width:600px;max-height:80vh;overflow-y:auto><div style=display:flex;justify-content:space-between;align-items:center;margin-bottom:20px><h2 style=color:var(--text-color);margin:0>内容上传</h2><button id=close-uploader-btn style="background:0 0;border:none;font-size:24px;cursor:pointer;color:var(--light-text)">×</button></div><form id=upload-form><div style=margin-bottom:15px><label style=display:block;margin-bottom:5px;color:var(--text-color)>上传类型</label>
<select id=upload-type style="width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px"><option value=chapter>章节</option><option value=volume>分卷</option><option value=collection>小说集</option><option value=discussion>讨论贴</option><option value=image>图片</option></select></div><div id=collection-fields style=margin-bottom:15px><label style=display:block;margin-bottom:5px;color:var(--text-color)>小说集名称</label>
<input type=text id=collection-name style="width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px"></div><div id=volume-fields style=margin-bottom:15px><label style=display:block;margin-bottom:5px;color:var(--text-color)>分卷名称</label>
<input type=text id=volume-name style="width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px"></div><div id=chapter-fields style=margin-bottom:15px><label style=display:block;margin-bottom:5px;color:var(--text-color)>章节标题</label>
<input type=text id=chapter-title style="width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px"></div><div id=discussion-fields style=margin-bottom:15px;display:none><label style=display:block;margin-bottom:5px;color:var(--text-color)>讨论标题</label>
<input type=text id=discussion-title style="width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px"></div><div id=image-fields style=margin-bottom:15px;display:none><label style=display:block;margin-bottom:5px;color:var(--text-color)>图片上传</label><div id=image-drop-zone style="border:2px dashed var(--border-color);border-radius:6px;padding:20px;text-align:center;color:var(--light-text);cursor:pointer">拖拽图片到此或点击选择文件
<input type=file id=image-file accept=image/* style=display:none></div><div style=margin-top:10px;display:flex;gap:10px;align-items:center><input type=text id=image-folder placeholder="static/images 或子目录，如 static/images/covers" style="flex:1;padding:10px;border:1px solid var(--border-color);border-radius:4px">
<button id=choose-image-btn type=button style="padding:8px 12px;border:1px solid var(--border-color);background:#f5f5f5;border-radius:4px;cursor:pointer">选择图片</button></div><div id=image-preview-wrap style=margin-top:10px;display:none><img id=image-preview src alt=预览 style="max-width:100%;max-height:200px;border:1px solid var(--border-color);border-radius:4px"></div><div style=margin-top:10px;display:flex;gap:10px;align-items:center><label style=display:flex;align-items:center;gap:6px;color:var(--text-color)><input type=checkbox id=compress-webp checked> 压缩为 WebP(质量 0.8)</label>
<label style=display:flex;align-items:center;gap:6px;color:var(--text-color)><input type=checkbox id=keep-original> 保留原图</label>
<button id=copy-image-url-btn type=button style="padding:6px 10px;border:1px solid var(--border-color);background:#f5f5f5;border-radius:4px;cursor:pointer;display:none">复制图片链接</button></div><div id=image-progress style=margin-top:8px;color:var(--light-text)>推荐使用 WebP 格式以降低体积</div></div><div style=margin-bottom:15px><label style=display:block;margin-bottom:5px;color:var(--text-color)>内容（支持Markdown格式）</label>
<textarea id=content rows=10 style="width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px;resize:vertical"></textarea></div><div style=margin-bottom:15px><label style=display:block;margin-bottom:5px;color:var(--text-color)>标签（用逗号分隔）</label>
<input type=text id=tags style="width:100%;padding:10px;border:1px solid var(--border-color);border-radius:4px" placeholder="如：冒险, 科幻, 悬疑"></div><div style=margin-bottom:20px><label style=display:block;margin-bottom:5px;color:var(--text-color)>是否为草稿</label>
<input type=checkbox id=draft style=margin-right:10px>
<span style=color:var(--light-text)>勾选表示保存为草稿</span></div><div style=margin-bottom:20px><label style=display:block;margin-bottom:5px;color:var(--text-color)>是否公开</label>
<input type=checkbox id=is-public style=margin-right:10px>
<span style=color:var(--light-text)>勾选表示公开内容（默认私密，仅登录可见）</span></div><div style=display:flex;gap:10px><button type=submit style=flex:1;padding:12px;background-color:var(--primary-color);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:16px>保存内容</button></div></form><div id=upload-status style=margin-top:20px;text-align:center></div></div></div><div id=admin-quick-actions data-permission=write style="display:none;position:fixed;bottom:30px;left:30px;z-index:1000;background:#fff;border:1px solid var(--border-color);border-radius:8px;padding:12px;box-shadow:0 2px 10px rgba(0,0,0,.15)"><div style=font-weight:600;margin-bottom:8px>页面快捷操作</div><div style=display:flex;gap:8px;flex-wrap:wrap;align-items:center><button id=enable-comments style="padding:8px 10px;background:#27ae60;color:#fff;border:none;border-radius:4px;cursor:pointer">开启评论</button>
<button id=disable-comments style="padding:8px 10px;background:#c0392b;color:#fff;border:none;border-radius:4px;cursor:pointer">关闭评论</button>
<input id=card-title placeholder=卡片标题 style="padding:8px;border:1px solid var(--border-color);border-radius:4px">
<input id=card-url placeholder=卡片URL style="padding:8px;border:1px solid var(--border-color);border-radius:4px">
<input id=card-image placeholder=卡片图片（可选） style="padding:8px;border:1px solid var(--border-color);border-radius:4px">
<button id=add-card style="padding:8px 10px;background:var(--primary-color);color:#fff;border:none;border-radius:4px;cursor:pointer">添加卡片</button>
<button id=open-discussion style="padding:8px 10px;background:#2980b9;color:#fff;border:none;border-radius:4px;cursor:pointer">本页讨论</button>
<input id=invite-count type=number min=1 max=500 placeholder=数量(默认10) style="padding:8px;border:1px solid var(--border-color);border-radius:4px;width:120px">
<input id=invite-days type=number min=1 max=3650 placeholder=有效天数(默认30) style="padding:8px;border:1px solid var(--border-color);border-radius:4px;width:140px">
<input id=invite-role placeholder=角色(默认reader) style="padding:8px;border:1px solid var(--border-color);border-radius:4px;width:150px">
<input id=invite-perms placeholder='权限JSON(默认["read"])' style="padding:8px;border:1px solid var(--border-color);border-radius:4px;width:180px">
<input id=invite-assigned placeholder=绑定ID(可选) style="padding:8px;border:1px solid var(--border-color);border-radius:4px;width:150px">
<button id=generate-invites style="padding:8px 10px;background:#8e44ad;color:#fff;border:none;border-radius:4px;cursor:pointer">批量生成邀请码</button></div><div id=admin-action-status style=margin-top:8px;font-size:.9rem;color:var(--light-text)></div><textarea id=invite-output readonly style="display:none;margin-top:8px;width:100%;height:120px;padding:8px;border:1px solid var(--border-color);border-radius:4px;font-family:monospace" placeholder=生成的邀请码将显示在此，按行分隔></textarea></div><div id=current-md-path data-path style=display:none></div><div id=site-mode data-offline=false style=display:none></div><script>window.CURRENT_MD_PATH=document.getElementById("current-md-path")?.dataset.path||"",document.addEventListener("DOMContentLoaded",function(){const o=getLocalUser(),n=document.getElementById("admin-quick-actions"),e=document.getElementById("admin-action-status"),i=document.getElementById("site-mode")?.dataset.offline==="true";if(i){n&&(n.style.display="none");return}if(o&&hasPermission("write")){n.style.display="block";const e=["invite-count","invite-days","invite-role","invite-perms","invite-assigned","generate-invites","invite-output"];hasPermission("admin")||e.forEach(e=>{const t=document.getElementById(e);t&&(t.style.display="none")})}async function t(t,n,s,o){let i=!1,a="";const r=getLocalUser(),c={repo:"Silent-Tiga/my-private-novel",path:t,action:n,payload:s,message:o,userId:r&&r.uid?r.uid:"",ts:Date.now()};try{let e=null;if(window.cloudbaseDb)e=window.cloudbaseDb;else if(window.cloudbase&&window.cloudbase.CloudBase){const t=window.CLOUDBASE_ENV_ID||"",n=window.cloudbase.init({env:t});e=n.database()}if(e){const t=await e.collection("admin_actions").add(c);i=!!t&&(!!t.id||!!t._id)}}catch(e){a=e&&e.message?e.message:String(e)}if(!i)try{const e=JSON.parse(localStorage.getItem("pendingAdminActions")||"[]");e.push(c),localStorage.setItem("pendingAdminActions",JSON.stringify(e)),i=!0}catch(e){a=a||(e&&e.message?e.message:String(e))}if(i)e.textContent="操作已记录（CloudBase/离线队列）。";else{let t="操作失败：";const n=a||"";/401|403|unauthorized|Insufficient permissions/i.test(n)?t+="权限不足，请登录或升级权限":/409|conflict/i.test(n)?t+="内容冲突，请刷新后重试":/5\d{2}/.test(n)?t+="服务器错误，请稍后重试":n?t+=n:t+="CloudBase 不可用且无法写入本地队列",e.textContent=t}}document.getElementById("enable-comments").addEventListener("click",function(){if(!window.CURRENT_MD_PATH){e.textContent="当前页面无关联文件路径";return}t(window.CURRENT_MD_PATH,"toggle_comments",{enabled:!0},"Enable comments")}),document.getElementById("disable-comments").addEventListener("click",function(){if(!window.CURRENT_MD_PATH){e.textContent="当前页面无关联文件路径";return}t(window.CURRENT_MD_PATH,"toggle_comments",{enabled:!1},"Disable comments")}),document.getElementById("add-card").addEventListener("click",function(){if(!window.CURRENT_MD_PATH){e.textContent="当前页面无关联文件路径";return}const n=document.getElementById("card-title").value.trim(),s=document.getElementById("card-url").value.trim(),o=document.getElementById("card-image").value.trim();if(!n||!s){e.textContent="请填写卡片标题与URL";return}t(window.CURRENT_MD_PATH,"set_cards",{cards:[{title:n,url:s,image:o}]},"Add card")}),document.getElementById("open-discussion").addEventListener("click",async function(){try{const n=window.CURRENT_MD_PATH||window.location.pathname,e=slugify(n||"page"),s=`content/forum/discussion/${e}.md`,o=`讨论：${document.title||e}`,i={frontmatter:{title:o,type:"discussion",tags:["页面"],related:window.CURRENT_MD_PATH||window.location.pathname,draft:!1},content:`本页（${n}）的讨论入口。`};await t(s,"create_entry",i,"Ensure page discussion");const a=`/forum/discussion/${e}/`;window.location.href=a}catch(t){e.textContent=`打开讨论失败：${t.message}`}});const s=document.getElementById("generate-invites");s&&s.addEventListener("click",async function(){const i=Number(document.getElementById("invite-count").value||""),a=Number(document.getElementById("invite-days").value||""),r=(document.getElementById("invite-role").value||"").trim(),c=(document.getElementById("invite-perms").value||"").trim(),l=(document.getElementById("invite-assigned").value||"").trim();let s=null;if(c)try{if(s=JSON.parse(c),!Array.isArray(s))throw new Error("权限必须是数组")}catch{alert("权限JSON不合法");return}const t={};i&&(t.count=Math.max(1,Math.min(500,i))),a&&(t.expDays=Math.max(1,Math.min(3650,a))),r&&(t.role=r),s&&(t.permissions=s),l&&(t.assignedId=l);let o=!1,n="";try{const e=getLocalUser(),s={action:"create_invites",payload:t,userId:e&&e.uid?e.uid:"",ts:Date.now()};if(window.cloudbaseDb)try{const e=await window.cloudbaseDb.collection("admin_actions").add(s);o=!!e&&(!!e.id||!!e._id)}catch(e){n=e.message||String(e)}if(!o)try{const e=JSON.parse(localStorage.getItem("pendingAdminActions")||"[]");e.push(s),localStorage.setItem("pendingAdminActions",JSON.stringify(e)),o=!0}catch(e){n=n||e.message||String(e)}}catch(e){n=e.message||String(e)}if(o){e.textContent="已记录邀请码生成请求（CloudBase/离线队列）。";const t=document.getElementById("invite-output");t.value="请求已记录，等待后台处理生成具体邀请码",t.style.display="block"}else e.textContent=`生成失败：${n||"CloudBase 不可用且无法写入本地队列"}`})})</script><script>function initUploader(){const b=document.getElementById("site-mode")?.dataset.offline==="true";if(b)return;const x=getLocalUser(),w=document.getElementById("uploader-float-btn"),s=document.getElementById("uploader-modal"),j=document.getElementById("show-uploader-btn"),p=document.getElementById("close-uploader-btn"),o=document.getElementById("upload-form"),r=document.getElementById("upload-type"),m=document.getElementById("collection-fields"),v=document.getElementById("volume-fields"),O=document.getElementById("chapter-fields"),y=document.getElementById("discussion-fields"),f=document.getElementById("image-fields"),t=document.getElementById("image-file"),l=document.getElementById("image-folder"),n=document.getElementById("image-drop-zone"),g=document.getElementById("image-preview-wrap"),h=document.getElementById("image-preview"),c=document.getElementById("image-progress"),i=document.getElementById("compress-webp"),u=document.getElementById("keep-original"),_=document.getElementById("copy-image-url-btn"),e=document.getElementById("upload-status");x&&hasPermission("write")&&(w.style.display="block");function d(){const e=r.value;m.style.display=e==="volume"||e==="chapter"?"block":"none",v.style.display=e==="chapter"?"block":"none",O.style.display=e==="chapter"?"block":"none",y.style.display=e==="discussion"?"block":"none",f.style.display=e==="image"?"block":"none"}j.addEventListener("click",function(){s.style.display="flex",d()}),p.addEventListener("click",function(){s.style.display="none",e.innerHTML="",o.reset()}),s.addEventListener("click",function(t){t.target===s&&(s.style.display="none",e.innerHTML="",o.reset())}),r.addEventListener("change",d),document.getElementById("choose-image-btn").addEventListener("click",()=>t.click()),n.addEventListener("click",()=>t.click()),n.addEventListener("dragover",e=>{e.preventDefault(),n.style.borderColor="#888"}),n.addEventListener("dragleave",()=>{n.style.borderColor="var(--border-color)"});function a(e){const t=new FileReader;t.onload=()=>{const s=t.result;h.src=s,g.style.display="block";const n=new Image;n.onload=()=>{const t=(e.size/1024/1024).toFixed(2);c.textContent=`已选择：${e.name} ${n.naturalWidth}x${n.naturalHeight} (${t}MB)`},n.src=s},t.readAsDataURL(e)}n.addEventListener("drop",e=>{e.preventDefault(),n.style.borderColor="var(--border-color)",e.dataTransfer.files&&e.dataTransfer.files[0]&&(t.files=e.dataTransfer.files,a(t.files[0]))}),n.addEventListener("paste",e=>{const n=e.clipboardData&&e.clipboardData.items;if(!n)return;for(const e of n)if(e.type&&e.type.startsWith("image/")){const n=e.getAsFile();n&&(t.files=(new DataTransfer).files,a(n));break}}),t.addEventListener("change",()=>{const e=t.files[0];if(!e)return;a(e)}),o.addEventListener("submit",function(n){n.preventDefault();const a=r.value,d=document.getElementById("collection-name").value.trim(),h=document.getElementById("volume-name").value.trim(),f=document.getElementById("chapter-title").value.trim(),p=document.getElementById("discussion-title").value.trim(),m=document.getElementById("content").value.trim(),g=document.getElementById("tags").value.trim(),v=document.getElementById("draft").checked,b=document.getElementById("is-public").checked;if(a==="image"){const n=t&&t.files&&t.files[0];if(!n){e.innerHTML='<span style="color: red;">请选择要上传的图片文件</span>';return}if(n.size>5*1024*1024){e.innerHTML='<span style="color: red;">图片大小不能超过 5MB</span>';return}const d=["image/png","image/jpeg","image/webp","image/gif"];if(!d.includes(n.type)){e.innerHTML='<span style="color: red;">仅支持 PNG/JPEG/WebP/GIF 格式图片</span>';return}const a=l&&l.value.trim()||"static/images",s=o.querySelector('button[type="submit"]');s&&(s.disabled=!0),e.innerHTML='<span style="color: var(--primary-color);">正在上传图片...</span>';const r=new FileReader;r.onload=async()=>{try{const l=r.result,O=getLocalUser();if(!O||!hasPermission("write")){e.innerHTML='<span style="color: red;">未登录或无写权限，请先登录</span>',s&&(s.disabled=!1);return}const w=(()=>{if(i.checked&&(n.type==="image/jpeg"||n.type==="image/png"))return"webp";const e={"image/png":"png","image/jpeg":"jpg","image/webp":"webp","image/gif":"gif"};return e[n.type]||"png"})(),y=n.name.replace(/\.[^.]+$/,""),v=(e=>e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\p{L}\p{N}-]+/gu,"").replace(/-+/g,"-").replace(/^-+|-+$/g,""))(y)||"untitled",b=(new Date).toISOString().slice(0,19).replace(/[-:T]/g,""),f=`${b}-${v}.${w}`;async function t(){if(i.checked&&(n.type==="image/jpeg"||n.type==="image/png")){const t=await new Promise(e=>{const t=new Image;t.onload=()=>e(t),t.src=l}),e=document.createElement("canvas");e.width=t.naturalWidth,e.height=t.naturalHeight;const s=e.getContext("2d");s.drawImage(t,0,0);const n=e.toDataURL("image/webp",.8),o=n.split(",")[1],i=await fetch(n),a=await i.blob();return{blob:a,base64:o}}const e=l.split(",")[1],t=await fetch(l),s=await t.blob();return{blob:s,base64:e}}async function o(e){const t=await e.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join("")}const m=await t(),p=await o(m.blob),x={file_base64:m.base64,folder:a,filename:f,sha256:p};let d=!1,j="";try{if(window.cloudbaseDb){const t={type:"image",folder:a,filename:f,sha256:p,file_base64:m.base64,ts:Date.now()},e=await window.cloudbaseDb.collection("uploads").add(t);d=!!e&&(!!e.id||!!e._id)}if(!d){const e=JSON.parse(localStorage.getItem("pendingUploads")||"[]");e.push({type:"image",folder:a,filename:f,sha256:p,file_base64:m.base64,ts:Date.now()}),localStorage.setItem("pendingUploads",JSON.stringify(e)),d=!0}}catch(e){j=e.message||String(e)}if(!d)throw new Error(j||"CloudBase 不可用且无法写入本地队列");c.textContent="已记录图片上传任务（CloudBase/离线队列）",_.style.display="none";let h=!1,g="";if(i&&u&&i.checked&&u.checked&&(n.type==="image/jpeg"||n.type==="image/png"))try{const t=l.split(",")[1],o=await fetch(l),i=await o.blob();let e="";{const t=await i.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);e=Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join("")}const r=n.type==="image/jpeg"?"jpg":"png",s=`${b}-${v}.${r}`,c={file_base64:t,folder:a,filename:s,sha256:e};try{if(window.cloudbaseDb){const o={type:"image",folder:a,filename:s,sha256:e,file_base64:t,ts:Date.now()},n=await window.cloudbaseDb.collection("uploads").add(o);h=!!n&&(!!n.id||!!n._id)}if(!h){const n=JSON.parse(localStorage.getItem("pendingUploads")||"[]");n.push({type:"image",folder:a,filename:s,sha256:e,file_base64:t,ts:Date.now()}),localStorage.setItem("pendingUploads",JSON.stringify(n)),h=!0}}catch(e){g=e.message||String(e)}h||console.warn("保留原图上传失败",g)}catch(e){console.warn("保留原图异常",e)}e.innerHTML='<span style="color: green;">图片上传成功</span>',s&&(s.disabled=!1)}catch(t){e.innerHTML=`<span style="color: red;">上传失败：${t.message}</span>`,s&&(s.disabled=!1)}},r.readAsDataURL(n);return}if(a==="chapter"&&(!d||!h||!f||!m)){e.innerHTML='<span style="color: red;">请填写所有必填字段</span>';return}if(a==="volume"&&(!d||!h)){e.innerHTML='<span style="color: red;">请填写小说集名称和分卷名称</span>';return}if(a==="collection"&&!d){e.innerHTML='<span style="color: red;">请填写小说集名称</span>';return}if(a==="discussion"&&(!p||!m)){e.innerHTML='<span style="color: red;">请填写讨论标题和内容</span>';return}e.innerHTML='<span style="color: var(--primary-color);">保存中...</span>',(async()=>{try{const r=window.cloudbaseDb,c=window.cloudbaseAuth;if(!r||!c||typeof c.getCurrentUser!="function")throw new Error("CloudBase 未初始化或用户未登录");const n=await c.getCurrentUser(),u=window.cloudbaseCollections||{},y=u.posts||"posts",_=u.novels||"novels",t=Date.now(),j=g?g.split(",").map(e=>e.trim()).filter(Boolean):[],l=e=>{const n=(e||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\p{L}\p{N}-]+/gu,"").replace(/-+/g,"-").replace(/^-+|-+$/g,"");return n||"untitled-"+t};let i=null;if(a==="discussion")i={type:"discussion",title:p,content:m,tags:j,authorUid:n.uid,authorEmail:n.email||"",createdAt:t,updatedAt:t,status:v?"draft":"published",visibility:b?"public":"private"},await r.collection(y).add(i),e.innerHTML='<span style="color: green;">已发布到论坛（CloudBase）</span>';else if(a==="collection"||a==="volume"||a==="chapter"){const s=l(d),o=l(h),c=l(f);i={type:a,title:a==="collection"?d:a==="volume"?h:f,content:m,tags:j,authorUid:n.uid,authorEmail:n.email||"",collectionSlug:s,volumeSlug:o,chapterSlug:c,createdAt:t,updatedAt:t,status:v?"draft":"published",visibility:b?"public":"private"},await r.collection(_).add(i),e.innerHTML='<span style="color: green;">已保存到小说集合（CloudBase）</span>'}else throw new Error("不支持的类型");setTimeout(function(){s.style.display="none",e.innerHTML="",o.reset()},1500)}catch(t){e.innerHTML=`<span style="color: red;">保存失败：${t.message}</span>`}})()})}document.addEventListener("DOMContentLoaded",function(){const e=getLocalUser(),t=document.getElementById("site-mode")?.dataset.offline==="true";!t&&e&&hasPermission("write")&&initUploader()})</script></body></html><script>window.CF_MEDIA_BASE=window.CF_MEDIA_BASE||"https://your-worker-subdomain.workers.dev";function getAuthJWTForMedia(){try{const e=getLocalUser();return e&&e.uid?e.uid:""}catch{return""}}function cfMediaUrl(e){try{const n=window.CF_MEDIA_BASE||"",t=getAuthJWTForMedia(),s=`key=${encodeURIComponent(e)}${t?`&t=${encodeURIComponent(t)}`:""}`;return`${n.replace(/\/$/,"")}/api/media/get?${s}`}catch{return e}}</script>